<!DOCTYPE html>
<head>
    <title>Get Location Example</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
<script>
            $(document).ready(function() {
                    let token = localStorage.getItem("Authorization");

                    $.ajax({
                        url: "/members/location",
                        type: "GET",
                        headers: {'Content-Type': 'application/json', 'Authorization': token},
                        success: function(response) {
                            localStorage.setItem("wschat.sender", response.userName)
                            $("#location").text(response.cityName + " ì‹œë¯¼ë¼ë¦¬ë§Œ ë³¼ ìˆ˜ ìˆì–´ìš” ğŸ˜");
                            $("#weather").text("í˜„ì¬ ë‚ ì”¨: " + response.weatherStatus);
                            $("#temperature").text("í˜„ì¬ ê¸°ì˜¨: " + response.temperature+"â„ƒ");
                        },
                        error: function(xhr, status, error) {
                            console.log(error);
                        }
                    });

                    $.ajax({
                        url: "/chat/rooms",
                        type: "GET",
                        headers: {'Content-Type': 'application/json', 'Authorization': token},
                        success: function(response) {
                            if(response.data){
                                let Rooms = response.data;
                                let talkId;
                                let lodgingId
                                let foodId;
                                let hotplaceId;
                                let trafficId;

                                for(let i=0; i<Rooms.length; i++){
                                switch(Rooms[i].postAndChatType){
                                    case 'TALK':
                                        talkId = Rooms[i].id;
                                        break;
                                    case 'LODGING':
                                        lodgingId = Rooms[i].id;
                                        break;
                                    case 'FOOD':
                                        foodId = Rooms[i].id;
                                        break;
                                    case 'HOTPLACE':
                                        hotplaceId = Rooms[i].id;
                                        break;
                                    case 'TRAFFIC':
                                        trafficId = Rooms[i].id;
                                        break;
                                    }
                                }

                                $('#chat-buttons').html(`
                                    <button id="talkchat" chatRoomId=${talkId} onclick="enterChat(event)">ì¡ë‹´</button>
                                    <button id="lodgingchat" chatRoomId=${lodgingId} onclick="enterChat(event)">ìˆ™ì†Œ</button>
                                    <button id="foodchat" chatRoomId=${foodId} onclick="enterChat(event)">ìŒì‹</button>
                                    <button id="hotplacechat" chatRoomId=${hotplaceId} onclick="enterChat(event)">í•«í”Œ</button>
                                    <button id="trafficchat" chatRoomId=${trafficId} onclick="enterChat(event)">êµí†µ</button>
                                  `);
                                  }
                        },
                        error: function(xhr, status, error) {
                            console.log(error);
                        }
                    });
            });





                    function enterChat(event) {
                        // enterChat()ë©”ì„œë“œ ì‹¤í–‰ í›„, chatRoomIdê°’ì´ ë¹„ì—ˆì„ ê²½ìš° ì•„ë˜ ì½”ë“œì‹¤í–‰ (ë£¸ ìƒì„± + ë£¸ ì§„ì…)
                        const buttonId = event.target.id;
                        const chatRoomId = event.target.getAttribute('chatRoomId');

                        // chatRoomIdê°€ undefinedì¸ ê²½ìš°, ìƒˆë¡œìš´ ì±„íŒ…ë°©ì„ ë§Œë“­ë‹ˆë‹¤.
                        if (chatRoomId === "undefined") {
                            let chatType;
                            let token = localStorage.getItem("Authorization");

                    switch(buttonId){
                        case 'talkchat':
                            chatType = "TALK";
                            break;
                        case 'lodgingchat':
                            chatType = "LODGING";
                            break;
                        case 'foodchat':
                            chatType = "FOOD";
                            break;
                        case 'hotplacechat':
                            chatType = "HOTPLACE";
                            break;
                        case 'trafficchat':
                            chatType = "TRAFFIC";
                            break;
                    }

                    var data = {
                                "chatType": chatType
                            }

                    $.ajax({
                        url: "/chat/room",
                        type: "POST",
                        headers: {'Content-Type': 'application/json', 'Authorization': token},
                        data: JSON.stringify(data),
                        success: function(response) {
                            localStorage.setItem('wschat.roomId',response.data.id);
                            window.location.href="/chat/room/enter/"+response.data.id;

                        },
                        error: function(xhr, status, error) {
                            console.log(error);
                        }
                    });
                } else{
                    localStorage.setItem('wschat.roomId',chatRoomId);
                    window.location.href="/chat/room/enter/"+chatRoomId;
            }
}

    </script>
<div id="location"></div>
<div id="weather"></div>
<div id="temperature"></div>

<p>ê²Œì‹œíŒ ì˜ì—­</p>
<button id="talk" onclick="window.location.href='/post/talk'">ì¡ë‹´</button>
<button id="lodging" onclick="window.location.href='/post/lodging'">ìˆ™ì†Œ</button>
<button id="food" onclick="window.location.href='/post/food'">ìŒì‹</button>
<button id="hotplace" onclick="window.location.href='/post/hotplace'">í•«í”Œ</button>
<button id="traffic" onclick="window.location.href='/post/traffic'">êµí†µ</button>

<br>

<p>ì˜¤í”ˆì±„íŒ…ë°© ì˜ì—­</p>
<div id="chat-buttons">
    <button id="talkchat" chatRoomId='' onclick="enterChat(event)">ì¡ë‹´</button>
    <button id="lodgingchat" chatRoomId='' onclick="enterChat(event)">ìˆ™ì†Œ</button>
    <button id="foodchat" chatRoomId='' onclick="enterChat(event)">ìŒì‹</button>
    <button id="hotplacechat" chatRoomId='' onclick="enterChat(event)">í•«í”Œ</button>
    <button id="trafficchat" chatRoomId='' onclick="enterChat(event)">êµí†µ</button>
</div>
</body>
</html>
